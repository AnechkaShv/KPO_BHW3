# Отчет по микросервисной системе управления заказами и платежами

## 1. Общее описание
Проект представляет собой микросервисную систему, состоящую из следующих компонентов:
- **Order Service** (`:8080`) – создание и управление заказами
- **Payment Service** (`:8081`) – управление счетами и обработка платежей
- **Frontend** (`:3000`) – веб-интерфейс для взаимодействия с API
- **RabbitMQ** – асинхронная обработка платежных операций
- **PostgreSQL** – хранение данных

## 2. Архитектура и паттерны

### 2.1. Микросервисная архитектура
Сервисы работают независимо и общаются через:
- HTTP API для синхронных запросов
- RabbitMQ для асинхронной обработки платежей

#### Функциональные обязанности:
| Сервис | Основные функции |
|--------|------------------|
| Order Service | Создание заказов, управление статусами, предоставление информации о заказах |
| Payment Service | Управление счетами пользователей, обработка платежей, проверка баланса |

### 2.2. Используемые паттерны
| Паттерн | Применение | Преимущества |
|---------|------------|--------------|
| CQRS | Разделение операций чтения/записи в Order/Payment Service | Улучшение производительности |
| Outbox Pattern | Надежная доставка сообщений через RabbitMQ | Гарантированная доставка событий |
| Circuit Breaker | Обработка ошибок подключения к БД/RabbitMQ | Повышение отказоустойчивости |
| Repository | Абстракция работы с PostgreSQL | Упрощение тестирования и замены хранилища |

## 3. API Endpoints

### 3.1. Order Service (`:8080`)
| Метод | Путь | Параметры | Статус-коды |
|-------|------|-----------|-------------|
| POST | `/orders/create` | `user_id`, `amount`, `description` | 201, 400, 500 |
| GET | `/orders/get` | `id` | 200, 404, 500 |
| GET | `/orders/list` | `user_id` | 200, 500 |

### 3.2. Payment Service (`:8081`)
| Метод | Путь | Параметры | Статус-коды |
|-------|------|-----------|------------|
| POST | `/payments/create-account` | `user_id` | 201, 400, 409, 500 |
| GET | `/payments/get-account` | `user_id` | 200, 404, 500 |
| POST | `/payments/deposit` | `user_id`, `amount` | 200, 400, 404, 500 |
| POST | `/payments/process` | `order_id`, `user_id`, `amount` | 200, 400, 404, 500 |

**Swagger документация:**
- Order Service: http://localhost:8080/swagger/index.html
- Payment Service: http://localhost:8081/swagger/index.html

## 4. Поток данных

### 4.1. Создание заказа
1. Клиент → POST `/orders/create`
2. Order Service:
   - Сохраняет заказ в БД
   - Добавляет событие в Outbox
3. RabbitMQ доставляет событие в Payment Service
4. Payment Service обрабатывает платеж

### 4.2. Обработка платежа
1. Payment Service проверяет баланс
2. При успехе:
   - Списание средств
   - Отправка события в Order Service
3. Order Service обновляет статус заказа

## 5. Запуск проекта

### 5.1. Требования
- Docker + docker-compose
- Node.js (для фронтенда)

### 5.2. Команды
```bash
docker-compose up --build
```
веб-приложение - http://localhost:3000

### Тестирование
Покрытие тестами более 15%